<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Lotto Demo</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%238EFA4C' d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 7h2v6h-2zM11 15h2v2h-2z'/%3E%3C/svg%3E" type="image/svg+xml">
    <style>
        body {
            font-family: 'Inter', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #0B0446; /* Dark background */
            min-height: 100vh;
            box-sizing: border-box;
            padding-top: 20px;
            visibility: hidden;
            overflow-x: hidden;
            display: block;
            color: #E0E0E0; /* Light text color for contrast */
        }

        /* Branding Bar */
        .branding-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #2A2550; /* Darker shade for bar */
            color: #E0E0E0;
            padding: 10px 15px;
            height: 60px;
            box-sizing: border-box;
            width: 100%;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .branding-bar .icon {
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            color: #8EFA4C; /* Accent color */
        }

        .branding-bar .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        .branding-bar .logo-text {
            font-size: 22px;
            font-weight: bold;
        }

        .branding-bar .football-icon {
            font-size: 20px;
            color: #8EFA4C; /* Accent color */
        }

        /* General Layout for Screens */
        .screen {
            display: none;
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            border: 1px solid #4A457A; /* Lighter border for dark mode */
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            background-color: #353066; /* Container background */
            min-height: calc(100vh - 40px);
            box-sizing: border-box;
            flex-direction: column;
            border-radius: 10px;
            color: #E0E0E0; /* Light text inside containers */
        }

        .screen.active {
            display: flex;
        }

        .content {
            flex-grow: 1;
            padding: 20px;
            text-align: center;
            overflow-y: auto;
        }

        .content h1, .content h2 {
            color: #8EFA4C; /* Accent color for headers */
            margin-bottom: 15px;
        }

        .content p {
            margin-bottom: 25px;
            color: #C0C0C0; /* Slightly lighter grey for paragraph text */
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 30px;
            text-align: left;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #E0E0E0;
        }

        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #5A558A; /* Darker border for select */
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
            background-color: #4A457A; /* Darker background for select */
            color: #E0E0E0;
        }

        /* Buttons */
        .full-width-btn {
            width: 100%;
            padding: 15px;
            background-color: #8EFA4C; /* Accent color for buttons */
            color: #0B0446; /* Dark text on light button */
            border: none;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
            margin-top: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .full-width-btn:hover {
            background-color: #7ADF3C; /* Slightly darker on hover */
            transform: translateY(-2px);
        }

        .full-width-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .full-width-btn:disabled {
            background-color: #606060; /* Grey for disabled */
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
            color: #A0A0A0;
        }

        /* Team Grid */
        .team-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* Always 2 columns */
            gap: 15px;
            margin-top: 25px;
            margin-bottom: 30px;
        }

        .team-tile {
            background-color: #353066; /* Container background */
            border: 1px solid #4A457A;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 180px;
            overflow: hidden;
            position: relative; /* For ribbon */
        }

        .team-tile.selected {
            border: 2px solid #8EFA4C; /* Accent color for selected */
            background-color: #4A457A; /* Darker background for selected */
        }

        .team-tile .crest {
            width: 60px;
            height: 60px;
            margin: 0 auto 10px;
            border-radius: 50%; /* Make it circular */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            color: white; /* White text inside crest */
            opacity: 0; /* Hidden initially for animation on screen2 */
            transition: opacity 1s ease-in-out;
            border: 2px solid rgba(255,255,255,0.3); /* Lighter border for crest */
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        /* Override opacity for crests on screens where they should always be visible */
        #screen3 .team-tile .crest,
        #screen4 .team-tile .crest,
        .modal-team-tile .crest {
            opacity: 1; /* Always visible on these screens */
        }


        .team-tile .team-info {
            font-size: 12px;
            color: #C0C0C0;
            margin-bottom: 10px;
            height: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .team-tile .team-info p strong {
            font-size: 1.1em; /* Bigger team name labels */
            color: #E0E0E0;
        }

        .team-tile .team-info p {
            margin: 2px 0;
        }

        .team-tile .pick-btn {
            width: 100%;
            padding: 8px;
            background-color: #8EFA4C; /* Accent color for buttons */
            color: #0B0446;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
        }

        .team-tile .pick-btn:hover {
            background-color: #7ADF3C;
            transform: translateY(-1px);
        }
        .team-tile .pick-btn:active {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(0,0,0,0.15);
        }

        .team-tile .pick-btn.picked {
            background-color: #5CB85C; /* A slightly different green for picked state */
            color: white; /* White tick */
        }

        /* Double Points Grid */
        #double-points-grid {
            grid-template-columns: repeat(2, 1fr); /* Always 2 columns */
            margin-bottom: 30px;
        }

        /* Double Points Tile Button Style (always accent color, no tick) */
        .double-points-tile .pick-btn {
            background-color: #8EFA4C; /* Accent color */
            color: #0B0446;
        }
        .double-points-tile .pick-btn:hover {
            background-color: #7ADF3C;
        }
        .double-points-tile.selected .pick-btn {
            background-color: #7ADF3C; /* Slightly darker accent when picked */
            color: #0B0446;
        }

        /* In-Play Grid */
        #in-play-grid {
            grid-template-columns: repeat(2, 1fr); /* Always 2 columns */
            margin-bottom: 30px;
        }

        .in-play-tile {
            background-color: #353066; /* Container background */
            border: 1px solid #4A457A;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 180px;
            position: relative;
        }

        .in-play-tile .crest {
            width: 60px;
            height: 60px;
            border-radius: 50%; /* Make it circular */
            font-size: 18px;
            font-weight: bold;
            color: white; /* White text inside crest */
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .in-play-tile .match-summary {
            font-size: 13px;
            color: #C0C0C0;
            margin-bottom: 5px;
        }
        .in-play-tile .match-score {
            font-size: 16px;
            font-weight: bold;
            color: #8EFA4C; /* Accent color for score */
            margin-bottom: 10px;
        }

        .in-play-tile .points {
            font-size: 24px;
            font-weight: bold;
            color: #8EFA4C; /* Accent color for number */
            display: flex;
            align-items: baseline;
            justify-content: center;
            gap: 5px;
            /* Ensure points don't spill */
            white-space: nowrap; /* Prevent breaking */
            min-width: 0; /* Allow shrinking if needed */
            flex-shrink: 0; /* Prevent shrinking if space is tight */
        }
        .in-play-tile .points .pts-text {
            font-size: 16px;
            color: #8EFA4C; /* Accent color for 'pts' as well */
        }

        /* Live Match Indicator */
        .live-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background-color: #8EFA4C; /* Accent green */
            border-radius: 50%;
            margin-left: 5px;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(142, 250, 76, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(142, 250, 76, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(142, 250, 76, 0);
            }
        }

        /* Double Points Ribbon */
        .double-points-ribbon {
            position: absolute;
            top: 0px; /* Adjusted position */
            left: -10px; /* Adjusted position */
            background-color: #FFD700; /* Gold */
            color: #333;
            padding: 5px 15px; /* Less wide */
            font-size: 10px;
            font-weight: bold;
            transform: rotate(-45deg); /* Rotated to top-left */
            transform-origin: 0% 100%; /* Pivot from bottom-left of the ribbon */
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 10;
        }

        /* Total Points Bar */
        #total-points-bar {
            background-color: #4A457A; /* Darker container background */
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 30px;
            font-size: 18px;
            font-weight: bold;
            color: #8EFA4C; /* Accent color */
            box-shadow: 0 2px 5px rgba(0,0,0,0.08);
        }

        /* Leaderboard */
        #leaderboard {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #4A457A;
            border-radius: 8px;
            background-color: #353066; /* Container background */
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed #4A457A; /* Darker dashed border */
            position: relative;
        }

        .leaderboard-item:last-child {
            border-bottom: none;
        }

        /* Gold backgrounds for top 3 */
        .leaderboard-item.gold-1st { background-color: rgba(255, 215, 0, 1); color: #0B0446; }
        .leaderboard-item.gold-2nd { background-color: rgba(255, 215, 0, 0.7); color: #0B0446; }
        .leaderboard-item.gold-3rd { background-color: rgba(255, 215, 0, 0.4); color: #0B0446; }

        .leaderboard-item.gold-1st .score,
        .leaderboard-item.gold-2nd .score,
        .leaderboard-item.gold-3rd .score {
            color: #0B0446; /* Dark text on gold background */
        }
        .leaderboard-item.gold-1st .rank,
        .leaderboard-item.gold-2nd .rank,
        .leaderboard-item.gold-3rd .rank,
        .leaderboard-item.gold-1st .emoji,
        .leaderboard-item.gold-2nd .emoji,
        .leaderboard-item.gold-3rd .emoji,
        .leaderboard-item.gold-1st .name,
        .leaderboard-item.gold-2nd .name,
        .leaderboard-item.gold-3rd .name {
            color: #0B0446; /* Dark text on gold background */
        }


        .leaderboard-item .rank {
            font-weight: bold;
            color: #C0C0C0;
            width: 30px; /* Keep width for alignment */
            text-align: left;
            padding-left: 5px; /* Small padding on left */
        }

        .leaderboard-item .emoji {
            font-size: 18px;
            margin-right: 8px;
        }

        .leaderboard-item .name {
            flex-grow: 1;
            text-align: left;
            color: #E0E0E0;
            font-weight: 500;
        }

        .leaderboard-item .score-group {
            display: flex;
            align-items: center;
            gap: 8px; /* Padding between prize and score */
        }

        .leaderboard-item .prize-tag {
            background-color: #8EFA4C; /* Accent green for prize tag */
            color: #0B0446;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
        }
        .leaderboard-item.gold-1st .prize-tag,
        .leaderboard-item.gold-2nd .prize-tag,
        .leaderboard-item.gold-3rd .prize-tag {
            background-color: #0B0446; /* Darker background for prize tag on gold */
            color: #8EFA4C;
        }


        .leaderboard-item .score {
            font-weight: bold;
            color: #8EFA4C; /* Accent color for score */
        }

        .leaderboard-item .view-details-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #8EFA4C; /* Accent color for button */
            padding: 5px;
            border-radius: 5px;
            transition: background-color 0.2s;
        }
        .leaderboard-item .view-details-btn:hover {
            background-color: #4A457A; /* Darker hover for button */
        }

        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8); /* Darker overlay */
            backdrop-filter: blur(5px); /* More blur */
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #353066; /* Container background */
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            width: 90%;
            max-width: 380px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: fadeInScale 0.3s ease-out;
            color: #E0E0E0;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .modal-close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 28px;
            font-weight: bold;
            color: #C0C0C0; /* Light grey close button */
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
        }
        .modal-close-btn:hover {
            color: #E0E0E0;
        }

        .modal-header {
            font-size: 22px;
            font-weight: bold;
            color: #8EFA4C; /* Accent color */
            margin-bottom: 10px;
            text-align: center;
            display: flex; /* To align emoji and name */
            align-items: center;
            justify-content: center;
            gap: 8px; /* Space between emoji and name */
        }

        .modal-header .emoji {
            font-size: 20px; /* Larger emoji in modal header */
        }

        .modal-total-points-bar {
            background-color: #4A457A; /* Darker container background */
            padding: 12px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            color: #8EFA4C; /* Accent color */
            box-shadow: 0 2px 5px rgba(0,0,0,0.08);
            margin-top: 10px;
            margin-bottom: 20px;
        }

        .modal-team-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
            margin-bottom: 20px;
        }

        /* Reusing in-play-tile styles for modal teams for consistency */
        .modal-team-tile {
            background-color: #353066; /* Container background */
            border: 1px solid #4A457A;
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 150px;
            position: relative;
        }
        .modal-team-tile .crest {
            width: 50px;
            height: 50px;
            font-size: 16px;
            margin: 0 auto 8px;
            border-radius: 50%; /* Ensure circular */
            color: white; /* White text inside crest */
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-team-tile .match-summary {
            font-size: 11px;
            margin-bottom: 3px;
            color: #C0C0C0;
        }
        .modal-team-tile .match-score {
            font-size: 14px;
            margin-bottom: 8px;
            color: #8EFA4C;
        }
        .modal-team-tile .points {
            font-size: 20px;
            gap: 3px;
            color: #8EFA4C;
        }
        .modal-team-tile .points .pts-text {
            font-size: 14px;
            color: #8EFA4C;
        }

        .modal-team-tile .double-points-ribbon {
            top: 5px;
            left: -15px;
            padding: 3px 10px;
            font-size: 8px;
            background-color: #FFD700; /* Gold */
            color: #333;
        }
    </style>
</head>
<body>

    <!-- SCREEN 1 - 'buy in' -->
    <div id="screen1" class="screen">
        <div class="branding-bar">
            <span class="icon home-icon">&#x2302;</span> <!-- Flat house icon -->
            <div class="logo">
                <span class="football-icon">⚽</span> <!-- Football icon moved left -->
                <span class="logo-text">Team Lotto</span>
            </div>
            <span class="icon info-icon">&#x2139;</span> <!-- Info icon -->
        </div>

        <div class="content">
            <h1>Welcome to Team Lotto</h1>
            <p>£10 buys you a ticket for the next 10 weeks.</p>

            <div class="form-group">
                <label for="league-select">Pick your league</label>
                <select id="league-select">
                    <option value="premier-league" selected>Premier League</option>
                    <option value="la-liga">La Liga</option>
                    <option value="ligue-1">Ligue 1</option>
                    <option value="bundesliga">Bundesliga</option>
                    <option value="serie-a">Serie A</option>
                </select>
            </div>

            <button id="buy-ticket-btn" class="full-width-btn">Buy my Team Lotto ticket (£10)</button>
        </div>
    </div>

    <!-- SCREEN 2 - 'pick 6' -->
    <div id="screen2" class="screen">
        <div class="branding-bar">
            <span class="icon home-icon">&#x2302;</span>
            <div class="logo">
                <span class="football-icon">⚽</span>
                <span class="logo-text">Team Lotto</span>
            </div>
            <span class="icon info-icon">&#x2139;</span>
        </div>

        <div class="content">
            <h2 class="page-header">Your week 1 teams</h2>
            <p>Pick 6 teams to play with this week.</p>

            <div id="team-grid" class="team-grid">
                <!-- Team tiles will be injected here by JavaScript -->
            </div>

            <button id="confirm-selections-btn" class="full-width-btn" disabled>Confirm selections</button>
        </div>
    </div>

    <!-- SCREEN 3 - double points -->
    <div id="screen3" class="screen">
        <div class="branding-bar">
            <span class="icon home-icon">&#x2302;</span>
            <div class="logo">
                <span class="football-icon">⚽</span>
                <span class="logo-text">Team Lotto</span>
            </div>
            <span class="icon info-icon">&#x2139;</span>
        </div>

        <div class="content">
            <h2 class="page-header">Double points</h2>
            <p>Pick one team to score double points</p>

            <div id="double-points-grid" class="team-grid">
                <!-- Selected teams will be injected here by JavaScript -->
            </div>

            <button id="submit-double-points-btn" class="full-width-btn" disabled>Submit</button>
        </div>
    </div>

    <!-- SCREEN 4 - In-play -->
    <div id="screen4" class="screen">
        <div class="branding-bar">
            <span class="icon home-icon">&#x2302;</span>
            <div class="logo">
                <span class="football-icon">⚽</span>
                <span class="logo-text">Team Lotto</span>
            </div>
            <span class="icon info-icon">&#x2139;</span>
        </div>

        <div class="content">
            <h2 class="page-header">Week 1 In-Play</h2>

            <div id="total-points-bar">
                Your Total Points: <span id="your-total-points">0</span>
            </div>

            <div id="in-play-grid" class="team-grid">
                <!-- In-play team tiles will be injected here by JavaScript -->
            </div>

            <h2 class="page-header">Leaderboard</h2>
            <div id="leaderboard">
                <!-- Leaderboard will be injected here by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Modal for Leaderboard User Details -->
    <div id="userDetailsModal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn">&times;</button>
            <div class="modal-header" id="modalUserName"></div>
            <div class="modal-total-points-bar">
                Total Points: <span id="modalUserTotalPoints">0</span>
            </div>
            <div class="modal-team-grid" id="modalUserTeams">
                <!-- User's teams will be injected here -->
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Screen Elements
            const screen1 = document.getElementById('screen1');
            const screen2 = document.getElementById('screen2');
            const screen3 = document.getElementById('screen3');
            const screen4 = document.getElementById('screen4');

            // Screen 1 elements
            const buyTicketBtn = document.getElementById('buy-ticket-btn');
            const homeIcons = document.querySelectorAll('.home-icon'); // All home icons

            // Screen 2 elements
            const teamGrid = document.getElementById('team-grid');
            const confirmSelectionsBtn = document.getElementById('confirm-selections-btn');
            let selectedTeams = []; // Stores the 6 picked teams

            // Screen 3 elements
            const doublePointsGrid = document.getElementById('double-points-grid');
            const submitDoublePointsBtn = document.getElementById('submit-double-points-btn');
            let doublePointsTeam = null;

            // Screen 4 elements
            const inPlayGrid = document.getElementById('in-play-grid');
            const leaderboardDiv = document.getElementById('leaderboard');
            const yourTotalPointsBar = document.getElementById('your-total-points');

            // Modal elements
            const userDetailsModal = document.getElementById('userDetailsModal');
            const modalCloseBtn = userDetailsModal.querySelector('.modal-close-btn');
            const modalUserName = userDetailsModal.querySelector('#modalUserName');
            const modalUserTeams = userDetailsModal.querySelector('#modalUserTeams');
            const modalUserTotalPoints = userDetailsModal.querySelector('#modalUserTotalPoints');


            // Helper function to show a screen
            function showScreen(screenId) {
                document.querySelectorAll('.screen').forEach(screen => {
                    screen.classList.remove('active');
                });
                document.getElementById(screenId).classList.add('active');
            }

            // Helper function to convert number to ordinal (e.g., 1 -> 1st, 2 -> 2nd)
            function getOrdinal(n) {
                const s = ["th", "st", "nd", "rd"];
                const v = n % 100;
                return n + (s[(v - 20) % 10] || s[v] || s[0]);
            }

            // Placeholder data for Premier League 2024-25 last week (simulated)
            const premierLeagueTeams = [
                { id: 'arsenal', name: 'Arsenal', abbr: 'ARS', color: '#EF0107', position: 1, opponent: 'Everton', opponentPosition: 15 },
                { id: 'man-city', name: 'Man City', abbr: 'MCI', color: '#6CABDD', position: 2, opponent: 'West Ham', opponentPosition: 9 },
                { id: 'liverpool', name: 'Liverpool', abbr: 'LIV', color: '#C8102E', position: 3, opponent: 'Wolves', opponentPosition: 12 },
                { id: 'aston-villa', name: 'Aston Villa', abbr: 'AVL', color: '#670E36', position: 4, opponent: 'Crystal Palace', opponentPosition: 10 },
                { id: 'tottenham', name: 'Tottenham', abbr: 'TOT', color: '#132257', position: 5, opponent: 'Sheffield Utd', opponentPosition: 20 },
                { id: 'chelsea', name: 'Chelsea', abbr: 'CHE', color: '#034694', position: 6, opponent: 'Bournemouth', opponentPosition: 14 },
                { id: 'newcastle', name: 'Newcastle', abbr: 'NEW', color: '#241F20', position: 7, opponent: 'Brentford', opponentPosition: 16 },
                { id: 'man-utd', name: 'Man Utd', abbr: 'MUN', color: '#DA291C', position: 8, opponent: 'Brighton', opponentPosition: 11 },
                { id: 'west-ham', name: 'West Ham', abbr: 'WHU', color: '#7A263A', position: 9, opponent: 'Man City', opponentPosition: 2 },
                { id: 'crystal-palace', name: 'Crystal Palace', abbr: 'CRY', color: '#1B458F', position: 10, opponent: 'Aston Villa', opponentPosition: 4 },
                { id: 'brighton', name: 'Brighton', abbr: 'BHA', color: '#0057B8', position: 11, opponent: 'Man Utd', opponentPosition: 8 },
                { id: 'wolves', name: 'Wolves', abbr: 'WOL', color: '#FDB913', position: 12, opponent: 'Liverpool', opponentPosition: 3 },
                { id: 'fulham', name: 'Fulham', abbr: 'FUL', color: '#000000', position: 13, opponent: 'Luton Town', opponentPosition: 18 },
                { id: 'bournemouth', name: 'Bournemouth', abbr: 'BOU', color: '#DA291C', position: 14, opponent: 'Chelsea', opponentPosition: 6 },
                { id: 'everton', name: 'Everton', abbr: 'EVE', color: '#003399', position: 15, opponent: 'Arsenal', opponentPosition: 1 },
                { id: 'brentford', name: 'Brentford', abbr: 'BRE', color: '#E30613', position: 16, opponent: 'Newcastle', opponentPosition: 7 },
                { id: 'nottingham-forest', name: 'Nottm Forest', abbr: 'NFO', color: '#DD0000', position: 17, opponent: 'Burnley', opponentPosition: 19 },
                { id: 'luton-town', name: 'Luton Town', abbr: 'LUT', color: '#F78F1E', position: 18, opponent: 'Fulham', opponentPosition: 13 },
                { id: 'burnley', name: 'Burnley', abbr: 'BUR', color: '#6C1D45', position: 19, opponent: 'Nottm Forest', opponentPosition: 17 },
                { id: 'sheffield-utd', name: 'Sheffield Utd', abbr: 'SHU', color: '#EE2737', position: 20, opponent: 'Tottenham', opponentPosition: 5 },
            ];

            // Emojis for leaderboard
            const randomEmojis = ['🐶', '🍕', '🚗', '🐱', '🍔', '✈️', '🦊', '🌮', '🚂', '🐻', '🍟', '🚲', '🐼', '🍩', '🚀'];


            // --- Screen 1 Logic ---
            if (buyTicketBtn) {
                buyTicketBtn.addEventListener('click', () => {
                    showScreen('screen2');
                    loadTeamsForScreen2(); // Load teams for Screen 2 when transitioning
                });
            }

            // Event listener for Home icons (to return to Screen 1)
            homeIcons.forEach(icon => {
                icon.addEventListener('click', () => {
                    showScreen('screen1');
                });
            });

            // --- Screen 2 Logic ---
            function createTeamTile(team) {
                const tile = document.createElement('div');
                tile.classList.add('team-tile');
                tile.dataset.teamId = team.id;

                // Find opponent's position
                const opponentTeam = premierLeagueTeams.find(t => t.name === team.opponent);
                const opponentPositionText = opponentTeam ? `(${getOrdinal(opponentTeam.position)})` : '';

                tile.innerHTML = `
                    <div class="crest" style="background-color: ${team.color};">${team.abbr}</div>
                    <div class="team-info">
                        <p><strong>${team.name}</strong></p>
                        <p>(${getOrdinal(team.position)})</p>
                        <p>vs ${team.opponent} ${opponentPositionText}</p>
                    </div>
                    <button class="pick-btn">Pick</button>
                `;

                const pickBtn = tile.querySelector('.pick-btn');
                pickBtn.addEventListener('click', () => {
                    if (tile.classList.contains('selected')) {
                        // Deselect team
                        tile.classList.remove('selected');
                        pickBtn.classList.remove('picked');
                        pickBtn.innerHTML = 'Pick';
                        selectedTeams = selectedTeams.filter(t => t.id !== team.id);
                    } else {
                        // Select team
                        if (selectedTeams.length < 6) {
                            tile.classList.add('selected');
                            pickBtn.classList.add('picked');
                            pickBtn.innerHTML = 'Picked ✔'; // White tick icon
                            selectedTeams.push(team);
                        } else {
                            displayMessage('You can only pick 6 teams!');
                        }
                    }
                    updateConfirmButtonState();
                });

                return tile;
            }

            function loadTeamsForScreen2() {
                teamGrid.innerHTML = ''; // Clear previous tiles
                selectedTeams = []; // Reset selections
                updateConfirmButtonState(); // Update button state
                const shuffledTeams = [...premierLeagueTeams].sort(() => 0.5 - Math.random()); // Shuffle for lottery feel
                const teamsToDisplay = shuffledTeams.slice(0, 10); // Take first 10

                teamsToDisplay.forEach((team, index) => {
                    const tile = createTeamTile(team);
                    teamGrid.appendChild(tile);
                    // Animate reveal
                    setTimeout(() => {
                        tile.classList.add('revealed');
                    }, 100 * index); // Stagger the reveal
                });
            }

            function updateConfirmButtonState() {
                if (confirmSelectionsBtn) {
                    confirmSelectionsBtn.disabled = selectedTeams.length !== 6;
                }
            }

            if (confirmSelectionsBtn) {
                confirmSelectionsBtn.addEventListener('click', () => {
                    if (selectedTeams.length === 6) {
                        showScreen('screen3');
                        loadTeamsForScreen3(); // Load teams for Screen 3
                    }
                });
            }

            // --- Screen 3 Logic ---
            function createDoublePointsTile(team) {
                const tile = document.createElement('div');
                tile.classList.add('team-tile', 'double-points-tile');
                tile.dataset.teamId = team.id;

                // Find opponent's position
                const opponentTeam = premierLeagueTeams.find(t => t.name === team.opponent);
                const opponentPositionText = opponentTeam ? `(${getOrdinal(opponentTeam.position)})` : '';

                tile.innerHTML = `
                    <div class="crest" style="background-color: ${team.color};">${team.abbr}</div>
                    <div class="team-info">
                        <p><strong>${team.name}</strong></p>
                        <p>(${getOrdinal(team.position)})</p>
                        <p>vs ${team.opponent} ${opponentPositionText}</p>
                    </div>
                    <button class="pick-btn">Pick</button>
                `;

                const pickBtn = tile.querySelector('.pick-btn');
                pickBtn.addEventListener('click', () => {
                    // Deselect any previously selected double points team
                    document.querySelectorAll('.double-points-tile.selected').forEach(t => {
                        t.classList.remove('selected');
                        t.querySelector('.pick-btn').innerHTML = 'Pick';
                    });

                    // Select the current team
                    tile.classList.add('selected');
                    pickBtn.innerHTML = 'Picked ✔'; // Added tick icon
                    doublePointsTeam = team;
                    updateSubmitDoublePointsButtonState();
                });

                return tile;
            }

            function loadTeamsForScreen3() {
                doublePointsGrid.innerHTML = '';
                doublePointsTeam = null; // Reset double points selection
                updateSubmitDoublePointsButtonState(); // Update button state

                selectedTeams.forEach(team => {
                    const tile = createDoublePointsTile(team);
                    doublePointsGrid.appendChild(tile);
                });
            }

            function updateSubmitDoublePointsButtonState() {
                if (submitDoublePointsBtn) {
                    submitDoublePointsBtn.disabled = doublePointsTeam === null;
                }
            }

            if (submitDoublePointsBtn) {
                submitDoublePointsBtn.addEventListener('click', () => {
                    if (doublePointsTeam) {
                        // Mark the double points team in the selectedTeams array
                        selectedTeams = selectedTeams.map(team => {
                            if (team.id === doublePointsTeam.id) {
                                return { ...team, isDoublePoints: true };
                            }
                            return team;
                        });
                        showScreen('screen4');
                        loadTeamsForScreen4(); // Load teams for Screen 4
                    }
                });
            }

            // --- Screen 4 Logic ---
            // Generate random UK names for leaderboard
            function generateRandomNames(count) {
                const firstNames = ['James', 'Emily', 'William', 'Olivia', 'George', 'Amelia', 'Harry', 'Isla', 'Noah', 'Ava', 'Charlotte', 'Arthur', 'Sophie', 'Leo', 'Mia'];
                const lastNames = ['Smith', 'Jones', 'Williams', 'Brown', 'Davies', 'Wilson', 'Evans', 'Thomas', 'Roberts', 'Johnson', 'Walker', 'Wright', 'Robinson', 'King', 'Baker'];
                const names = [];
                for (let i = 0; i < count; i++) {
                    const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
                    const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
                    names.push(`${firstName} ${lastName}`);
                }
                return names;
            }

            // Helper to get a random emoji
            function getRandomEmoji() {
                return randomEmojis[Math.floor(Math.random() * randomEmojis.length)];
            }

            function generateMatchData(teamName) {
                const matchStatuses = ['15 min', 'HT', '60 min', 'FT'];
                const randomStatus = matchStatuses[Math.floor(Math.random() * matchStatuses.length)];
                const teamInList = premierLeagueTeams.find(t => t.name === teamName);
                const opponent = teamInList ? teamInList.opponent : 'Unknown Opponent';
                const homeOrAway = Math.random() > 0.5 ? 'H' : 'A'; // Simple random for home/away

                let homeScore = Math.floor(Math.random() * 4); // 0-3
                let awayScore = Math.floor(Math.random() * 4); // 0-3

                // Ensure scores are different if it's not a draw
                if (homeScore === awayScore && Math.random() < 0.3) { // 30% chance of a draw
                    // Keep it a draw
                } else if (homeScore === awayScore) { // If it's a draw and not intended, make one score higher
                    if (Math.random() > 0.5) { homeScore++; } else { awayScore++; }
                }

                let result = 'drawn'; // Default to drawn
                if (homeOrAway === 'H') { // If our team is home
                    if (homeScore > awayScore) { result = 'won'; }
                    else if (homeScore < awayScore) { result = 'lost'; }
                } else { // If our team is away
                    if (awayScore > homeScore) { result = 'won'; }
                    else if (awayScore < homeScore) { result = 'lost'; }
                }

                const fixtureText = `${homeOrAway === 'H' ? teamName : opponent} vs ${homeOrAway === 'H' ? opponent : teamName}`;
                const scoreText = `${homeScore} - ${awayScore}`;

                return {
                    fixture: fixtureText,
                    status: randomStatus,
                    score: scoreText,
                    result: result // 'won', 'drawn', 'lost'
                };
            }

            function calculatePoints(team, matchResult) {
                let basePoints = 0;
                if (matchResult === 'won') {
                    basePoints = 50;
                } else if (matchResult === 'drawn') {
                    basePoints = 20;
                } else { // lost
                    basePoints = 0;
                }

                if (team.isDoublePoints) {
                    return basePoints * 2;
                }
                return basePoints;
            }

            function createInPlayTile(team) {
                const tile = document.createElement('div');
                tile.classList.add('in-play-tile');

                const matchData = generateMatchData(team.name);
                const points = calculatePoints(team, matchData.result);

                let statusHtml = matchData.status;
                if (matchData.status !== 'FT') {
                    statusHtml = `<span style="color: #8EFA4C; font-weight: bold;">${matchData.status} <span class="live-indicator"></span></span>`;
                }

                let ribbonHtml = '';
                if (team.isDoublePoints) {
                    ribbonHtml = '<div class="double-points-ribbon">x2 points</div>';
                }

                tile.innerHTML = `
                    <div class="crest" style="background-color: ${team.color};">${team.abbr}</div>
                    <div class="match-summary">
                        <p>${matchData.fixture}</p>
                        <p style="color: #C0C0C0;">${statusHtml}</p>
                    </div>
                    <div class="match-score">${matchData.score}</div>
                    <div class="points">${points} <span class="pts-text">pts</span></div>
                    ${ribbonHtml}
                `;
                return tile;
            }

            function loadTeamsForScreen4() {
                inPlayGrid.innerHTML = '';
                let currentTotalPoints = 0;
                selectedTeams.forEach(team => {
                    const tile = createInPlayTile(team);
                    inPlayGrid.appendChild(tile);
                    // Extract points from the created tile for total calculation
                    const pointsElement = tile.querySelector('.points');
                    if (pointsElement) {
                        const pointsText = pointsElement.textContent;
                        currentTotalPoints += parseInt(pointsText.replace(' pts', ''));
                    }
                });
                yourTotalPointsBar.textContent = currentTotalPoints;
                updateLeaderboard();
            }

            let allLeaderboardUsers = []; // Store all leaderboard users for modal access

            function updateLeaderboard() {
                leaderboardDiv.innerHTML = '';
                const users = generateRandomNames(9); // 9 other users
                let leaderboardEntries = [];

                // Add the current user (you) with their actual selected teams and points
                const yourTeamsWithMatchData = selectedTeams.map(team => {
                    const matchData = generateMatchData(team.name);
                    const points = calculatePoints(team, matchData.result);
                    return { ...team, matchData, points };
                });
                const yourTotalPoints = yourTeamsWithMatchData.reduce((sum, team) => sum + team.points, 0);
                leaderboardEntries.push({ name: 'You', score: yourTotalPoints, teams: yourTeamsWithMatchData, emoji: getRandomEmoji() }); // Add emoji for 'You'

                // Add random scores and simulated teams for other users
                users.forEach(user => {
                    let userTeams = [];
                    let userTotalPoints = 0;
                    const shuffledAllTeams = [...premierLeagueTeams].sort(() => 0.5 - Math.random());
                    const randomPickedTeams = shuffledAllTeams.slice(0, 6); // Simulate 6 picked teams

                    // Randomly assign one double points team for other users
                    const doublePointsIndex = Math.floor(Math.random() * 6);
                    randomPickedTeams.forEach((team, index) => {
                        const isDoublePoints = index === doublePointsIndex;
                        const matchData = generateMatchData(team.name);
                        const points = calculatePoints({ ...team, isDoublePoints }, matchData.result); // Calculate with double points consideration
                        userTeams.push({ ...team, isDoublePoints, matchData, points });
                        userTotalPoints += points;
                    });

                    leaderboardEntries.push({ name: user, score: userTotalPoints, teams: userTeams, emoji: getRandomEmoji() });
                });

                // Sort by score descending
                leaderboardEntries.sort((a, b) => b.score - a.score);
                allLeaderboardUsers = leaderboardEntries; // Store for modal

                leaderboardEntries.forEach((entry, index) => {
                    const item = document.createElement('div');
                    item.classList.add('leaderboard-item');

                    // Add gold background classes
                    if (index === 0) { item.classList.add('gold-1st'); }
                    else if (index === 1) { item.classList.add('gold-2nd'); }
                    else if (index === 2) { item.classList.add('gold-3rd'); }

                    let prizeTagHtml = '';
                    if (index === 0) { prizeTagHtml = '<span class="prize-tag">£100</span>'; }
                    else if (index === 1) { prizeTagHtml = '<span class="prize-tag">£50</span>'; }
                    else if (index === 2) { prizeTagHtml = '<span class="prize-tag">£20</span>'; }


                    item.innerHTML = `
                        <span class="rank">${index + 1}</span> <!-- Removed dot -->
                        <span class="emoji">${entry.emoji}</span>
                        <span class="name">${entry.name}</span>
                        <span class="score-group">
                            ${prizeTagHtml}
                            <span class="score">${entry.score}</span>
                        </span>
                        <button class="view-details-btn" data-user-index="${index}">&#x25B6;</button> <!-- Right arrow icon -->
                    `;
                    leaderboardDiv.appendChild(item);
                });

                // Add event listeners for modal buttons
                document.querySelectorAll('.view-details-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const userIndex = event.target.dataset.userIndex;
                        openUserDetailsModal(allLeaderboardUsers[userIndex]);
                    });
                });
            }

            // --- Modal Logic ---
            function openUserDetailsModal(user) {
                modalUserName.innerHTML = `<span class="emoji">${user.emoji}</span> ${user.name}`; // Add emoji to modal header
                modalUserTotalPoints.textContent = user.score;
                modalUserTeams.innerHTML = '';

                user.teams.forEach(team => {
                    const tile = document.createElement('div');
                    tile.classList.add('modal-team-tile'); // Apply modal-specific sizing

                    let statusHtml = team.matchData.status;
                    if (team.matchData.status !== 'FT') {
                        statusHtml = `<span style="color: #8EFA4C; font-weight: bold;">${team.matchData.status}</span>`;
                    }

                    let ribbonHtml = '';
                    if (team.isDoublePoints) {
                        ribbonHtml = '<div class="double-points-ribbon">x2 points</div>';
                    }

                    tile.innerHTML = `
                        <div class="crest" style="background-color: ${team.color};">${team.abbr}</div>
                        <div class="match-summary">
                            <p><strong>${team.name}</strong></p>
                            <p>${team.matchData.fixture}</p>
                            <p style="color: #C0C0C0;">${statusHtml}</p>
                        </div>
                        <div class="match-score">${team.matchData.score}</div>
                        <div class="points">${team.points} <span class="pts-text">pts</span></div>
                        ${ribbonHtml}
                    `;
                    modalUserTeams.appendChild(tile);
                });

                userDetailsModal.style.display = 'flex'; // Show modal
            }

            modalCloseBtn.addEventListener('click', () => {
                userDetailsModal.style.display = 'none'; // Hide modal
            });

            // Close modal if clicked outside content
            userDetailsModal.addEventListener('click', (event) => {
                if (event.target === userDetailsModal) {
                    userDetailsModal.style.display = 'none';
                }
            });


            // Custom message box function (replaces alert())
            function displayMessage(message) {
                const messageBox = document.createElement('div');
                messageBox.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background-color: #353066; /* Dark mode background */
                    color: #E0E0E0;
                    padding: 15px 25px;
                    border-radius: 8px;
                    box-shadow: 0 4px 10px rgba(0,0,0,0.5);
                    z-index: 9999;
                    font-size: 16px;
                    text-align: center;
                    opacity: 0;
                    transition: opacity 0.3s ease-in-out;
                `;
                messageBox.textContent = message;
                document.body.appendChild(messageBox);

                // Fade in
                setTimeout(() => {
                    messageBox.style.opacity = '1';
                }, 10);

                // Fade out and remove after 2 seconds
                setTimeout(() => {
                    messageBox.style.opacity = '0';
                    messageBox.addEventListener('transitionend', () => {
                        messageBox.remove();
                    }, { once: true });
                }, 2000);
            }


            // Initially show Screen 1 when the page loads
            showScreen('screen1');
            // Make the body visible after the first screen is set up
            document.body.style.visibility = 'visible';
        });
    </script>
</body>
</html>

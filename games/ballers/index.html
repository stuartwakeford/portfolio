<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ballers - Pick Team</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a2e; /* Dark purple background */
            color: #ffffff;
            overflow-x: hidden; /* Prevent horizontal scroll on body */
        }
        /* Custom scrollbar for horizontal rows */
        .scroll-container::-webkit-scrollbar {
            height: 8px;
        }
        .scroll-container::-webkit-scrollbar-track {
            background: #2a2a4a; /* Darker track */
            border-radius: 10px;
        }
        .scroll-container::-webkit-scrollbar-thumb {
            background: #4F46E5; /* Indigo thumb */
            border-radius: 10px;
        }
        .scroll-container::-webkit-scrollbar-thumb:hover {
            background: #6366F1; /* Lighter indigo on hover */
        }
        /* Style for the team crest circle */
        .team-crest-circle {
            width: 32px; /* Small size */
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem; /* text-xs */
            font-weight: bold;
            color: white;
            position: absolute;
            top: 8px; /* Position within the card, not the image */
            right: 8px; /* Position within the card, not the image */
            border: 1px solid rgba(255, 255, 255, 0.3); /* Slight border for definition */
            text-shadow: 0 0 2px rgba(0,0,0,0.5);
            z-index: 10; /* Ensure it's above other elements in the card */
        }
        /* Ensure buttons have pointer cursor by default */
        .pick-btn {
            cursor: pointer;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <!-- Header -->
    <header class="bg-[#2a2a4a] p-4 flex items-center justify-between rounded-b-xl shadow-lg">
        <button class="text-gray-300 text-sm font-semibold px-2 py-1 rounded-md hover:bg-[#3a3a5a]">X CANCEL</button>
        <h1 class="text-xl font-bold text-white">BALLERS <span class="text-sm font-normal text-gray-400">EPL</span></h1>
        <div class="flex space-x-4">
            <button class="text-gray-300 text-xl hover:text-white">?</button>
            <button class="text-gray-300 text-xl hover:text-white">⚙️</button>
        </div>
    </header>

    <!-- Selection Screen -->
    <div id="selection-screen" class="flex-grow flex flex-col p-4 space-y-6">
        <!-- Player Selection Rows -->
        <div id="defenders-row" class="bg-[#2a2a4a] p-4 rounded-xl shadow-md">
            <h2 class="text-lg font-semibold mb-3 text-white text-center">PICK TWO DEFENDERS</h2>
            <div class="flex overflow-x-scroll space-x-4 pb-4 scroll-container">
                <!-- Defender cards will be injected here by JavaScript -->
            </div>
        </div>

        <div id="midfielders-row" class="bg-[#2a2a4a] p-4 rounded-xl shadow-md">
            <h2 class="text-lg font-semibold mb-3 text-white text-center">PICK TWO MIDFIELDERS</h2>
            <div class="flex overflow-x-scroll space-x-4 pb-4 scroll-container">
                <!-- Midfielder cards will be injected here by JavaScript -->
            </div>
        </div>

        <div id="forwards-row" class="bg-[#2a2a4a] p-4 rounded-xl shadow-md">
            <h2 class="text-lg font-semibold mb-3 text-white text-center">PICK TWO FORWARDS</h2>
            <div class="flex overflow-x-scroll space-x-4 pb-4 scroll-container">
                <!-- Forward cards will be injected here by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Save Picks Button -->
    <footer id="selection-footer" class="p-4 bg-[#1a1a2e] sticky bottom-0 z-10">
        <button id="save-picks-btn" class="w-full bg-[#4F46E5] text-white font-bold py-3 px-6 rounded-full shadow-lg transition-all duration-300 hover:bg-[#6366F1] disabled:opacity-50 disabled:cursor-not-allowed" disabled>
            SAVE MY PICKS
        </button>
    </footer>

    <!-- Results Screen -->
    <div id="results-screen" class="flex-grow flex flex-col p-4 space-y-6 hidden">
        <div class="bg-[#2a2a4a] p-4 rounded-xl shadow-md text-center">
            <h2 class="text-2xl font-bold text-white mb-2">TOTAL POINTS: <span id="total-points" class="text-green-400">0</span></h2>
        </div>

        <div id="picked-players-grid" class="grid grid-cols-2 gap-4 sm:grid-cols-3 lg:grid-cols-3">
            <!-- Picked player tiles with points will be injected here -->
        </div>

        <button id="play-again-btn" class="w-full bg-[#4F46E5] text-white font-bold py-3 px-6 rounded-full shadow-lg transition-all duration-300 hover:bg-[#6366F1]">
            PLAY AGAIN
        </button>
    </div>

    <script>
        // Mapping of team abbreviations to their main colors
        const teamColors = {
            "TOT": "#130C2E", // Tottenham (dark blue/purple)
            "LIV": "#C80815", // Liverpool (red)
            "CHE": "#034694", // Chelsea (blue)
            "ARS": "#EF0107", // Arsenal (red)
            "MNU": "#DA291C", // Man Utd (red)
            "MCI": "#6CABDD", // Man City (sky blue)
            "NEW": "#241F20", // Newcastle (black)
            "AST": "#4F002D", // Aston Villa (claret)
            "BOU": "#DA291C", // Bournemouth (red)
            "WHU": "#7A263A", // West Ham (claret)
            "CP": "#1B458F",  // Crystal Palace (blue)
            // Add more teams as needed
        };

        // Player data for each position (image URLs are placeholders as per instruction)
        const players = {
            defenders: [
                { id: 'def-1', name: "Porro", team: "TOT", opponent: "BOU", stars: 3, image: "https://placehold.co/100x100/4F46E5/FFFFFF?text=P" },
                { id: 'def-2', name: "Robertson", team: "LIV", opponent: "WHU", stars: 4, image: "https://placehold.co/100x100/4F46E5/FFFFFF?text=R" },
                { id: 'def-3', name: "James", team: "CHE", opponent: "ARS", stars: 3, image: "https://placehold.co/100x100/4F46E5/FFFFFF?text=J" },
                { id: 'def-4', name: "Saliba", team: "ARS", opponent: "MNU", stars: 4, image: "https://placehold.co/100x100/4F46E5/FFFFFF?text=S" },
                { id: 'def-5', name: "Stones", team: "MCI", opponent: "LIV", stars: 5, image: "https://placehold.co/100x100/4F46E5/FFFFFF?text=S" },
                { id: 'def-6', name: "Trippier", team: "NEW", opponent: "CHE", stars: 4, image: "https://placehold.co/100x100/4F46E5/FFFFFF?text=T" }
            ],
            midfielders: [
                { id: 'mid-1', name: "Odegaard", team: "ARS", opponent: "CHE", stars: 4, image: "https://placehold.co/100x100/4F46E5/FFFFFF?text=O" },
                { id: 'mid-2', name: "Maddison", team: "TOT", opponent: "BOU", stars: 4, image: "https://placehold.co/100x100/4F46E5/FFFFFF?text=M" },
                { id: 'mid-3', name: "Garnacho", team: "MNU", opponent: "LIV", stars: 3, image: "https://placehold.co/100x100/4F46E5/FFFFFF?text=G" },
                { id: 'mid-4', name: "Joelinton", team: "NEW", opponent: "WHU", stars: 4, image: "https://placehold.co/100x100/4F46E5/FFFFFF?text=J" },
                { id: 'mid-5', name: "Saka", team: "ARS", opponent: "MNU", stars: 5, image: "https://placehold.co/100x100/4F46E5/FFFFFF?text=S" },
                { id: 'mid-6', name: "Foden", team: "MCI", opponent: "TOT", stars: 5, image: "https://placehold.co/100x100/4F46E5/FFFFFF?text=F" }
            ],
            forwards: [
                { id: 'fwd-1', name: "Johnson", team: "TOT", opponent: "BOU", stars: 3, image: "https://placehold.co/100x100/4F46E5/FFFFFF?text=J" },
                { id: 'fwd-2', name: "Havertz", team: "CHE", opponent: "ARS", stars: 3, image: "https://placehold.co/100x100/4F46E5/FFFFFF?text=H" },
                { id: 'fwd-3', name: "Watkins", team: "AST", opponent: "NEW", stars: 4, image: "https://placehold.co/100x100/4F46E5/FFFFFF?text=W" },
                { id: 'fwd-4', name: "Nunez", team: "LIV", opponent: "WHU", stars: 3, image: "https://placehold.co/100x100/4F46E5/FFFFFF?text=N" },
                { id: 'fwd-5', name: "Isak", team: "NEW", opponent: "CHE", stars: 4, image: "https://placehold.co/100x100/4F46E5/FFFFFF?text=I" },
                { id: 'fwd-6', name: "Haaland", team: "MCI", opponent: "TOT", stars: 5, image: "https://placehold.co/100x100/4F46E5/FFFFFF?text=H" }
            ]
        };

        // Object to keep track of selected players for each position
        const selectedPlayers = {
            defenders: [],
            midfielders: [],
            forwards: []
        };

        // Get references to HTML elements
        const selectionScreen = document.getElementById('selection-screen');
        const selectionFooter = document.getElementById('selection-footer');
        const resultsScreen = document.getElementById('results-screen');
        const savePicksBtn = document.getElementById('save-picks-btn');
        const totalPointsDisplay = document.getElementById('total-points');
        const pickedPlayersGrid = document.getElementById('picked-players-grid');
        const playAgainBtn = document.getElementById('play-again-btn');

        /**
         * Renders player cards for a given position into the specified container.
         * @param {string} positionType - 'defenders', 'midfielders', or 'forwards'.
         * @param {HTMLElement} container - The HTML element to append player cards to.
         */
        function renderPlayers(positionType, container) {
            container.innerHTML = ''; // Clear existing cards
            players[positionType].forEach(player => {
                const isPicked = selectedPlayers[positionType].includes(player.id);
                const card = document.createElement('div');
                // Make the card position relative for absolute positioning of the crest
                card.className = `relative flex-none w-36 bg-[#1a1a2e] rounded-xl shadow-md p-3 text-center transition-all duration-200 ${isPicked ? 'border-2 border-green-500' : 'border-2 border-transparent'}`;
                
                const teamColor = teamColors[player.team] || '#6B7280'; // Default to gray if color not found

                card.innerHTML = `
                    <div class="w-24 h-24 mx-auto mb-2 rounded-full overflow-hidden border-2 border-[#4F46E5]">
                        <img src="${player.image}" alt="${player.name}" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='https://placehold.co/100x100/4F46E5/FFFFFF?text=Player';">
                    </div>
                    <div class="team-crest-circle" style="background-color: ${teamColor};">
                        ${player.team}
                    </div>
                    <p class="font-semibold text-white text-md">${player.name}</p>
                    <p class="text-gray-400 text-xs">v ${player.opponent}</p>
                    <div class="flex justify-center my-1">
                        ${'⭐'.repeat(player.stars)}
                    </div>
                    <button data-player-id="${player.id}" data-position-type="${positionType}"
                            class="pick-btn w-full mt-2 py-2 rounded-full font-bold text-sm transition-colors duration-200
                                   ${isPicked ? 'bg-green-500 text-white' : 'bg-[#4F46E5] text-white hover:bg-[#6366F1]'}">
                        ${isPicked ? 'PICKED' : 'PICK'}
                    </button>
                `;
                container.appendChild(card);
            });
            updatePickButtons(positionType); // Update button states after rendering
        }

        /**
         * Updates the state (enabled/disabled, text, color) of pick buttons in a specific row.
         * @param {string} positionType - 'defenders', 'midfielders', or 'forwards'.
         */
        function updatePickButtons(positionType) {
            const buttons = document.querySelectorAll(`#${positionType}-row .pick-btn`);
            const currentPickedCount = selectedPlayers[positionType].length;

            buttons.forEach(button => {
                const playerId = button.dataset.playerId;
                const isCurrentlyPicked = selectedPlayers[positionType].includes(playerId);
                const cardElement = button.closest('.flex-none');

                if (isCurrentlyPicked) {
                    button.classList.remove('bg-[#4F46E5]', 'hover:bg-[#6366F1]');
                    button.classList.add('bg-green-500', 'text-white');
                    button.textContent = 'PICKED';
                    cardElement.classList.add('border-green-500');
                    cardElement.classList.remove('border-transparent');
                } else {
                    button.classList.remove('bg-green-500', 'text-white');
                    button.classList.add('bg-[#4F46E5]', 'hover:bg-[#6366F1]');
                    button.textContent = 'PICK';
                    cardElement.classList.remove('border-green-500');
                    cardElement.classList.add('border-transparent');
                }

                // Disable 'PICK' buttons if 2 players are already picked in this row and this player is not picked
                if (currentPickedCount >= 2 && !isCurrentlyPicked) {
                    button.disabled = true;
                    button.classList.add('opacity-50', 'cursor-not-allowed');
                } else {
                    button.disabled = false;
                    button.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            });
            updateSaveButtonState(); // Update the main save button state
            savePicksToLocalStorage(); // Save current state to local storage
        }

        /**
         * Handles the click event for player 'PICK' buttons.
         * @param {Event} event - The click event object.
         */
        function handlePickButtonClick(event) {
            const button = event.target;
            const playerId = button.dataset.playerId;
            const positionType = button.dataset.positionType;

            const index = selectedPlayers[positionType].indexOf(playerId);

            if (index > -1) {
                // Player is already picked, so unpick them
                selectedPlayers[positionType].splice(index, 1);
            } else {
                // Player is not picked
                if (selectedPlayers[positionType].length < 2) {
                    // Pick the player if less than 2 are picked in this row
                    selectedPlayers[positionType].push(playerId);
                }
            }
            updatePickButtons(positionType); // Update buttons in the clicked row
        }

        /**
         * Updates the enabled/disabled state of the 'SAVE MY PICKS' button.
         */
        function updateSaveButtonState() {
            const totalPicked = Object.values(selectedPlayers).flat().length;
            savePicksBtn.disabled = totalPicked !== 6; // Enable only if exactly 6 players are picked
        }

        /**
         * Displays the selected players and their points on the results screen.
         */
        function showResultsScreen() {
            selectionScreen.classList.add('hidden');
            selectionFooter.classList.add('hidden');
            resultsScreen.classList.remove('hidden');
            pickedPlayersGrid.innerHTML = ''; // Clear previous results

            let totalPoints = 0;
            let allPickedPlayersData = [];

            for (const positionType in selectedPlayers) {
                selectedPlayers[positionType].forEach(playerId => {
                    const player = players[positionType].find(p => p.id === playerId);
                    if (player) {
                        const points = Math.floor(Math.random() * 100) + 1; // Random points between 1 and 100
                        totalPoints += points;
                        allPickedPlayersData.push({ ...player, points: points });
                    }
                });
            }

            allPickedPlayersData.forEach(player => {
                const card = document.createElement('div');
                const teamColor = teamColors[player.team] || '#6B7280'; // Default to gray if color not found
                card.className = `relative bg-[#1a1a2e] rounded-xl shadow-md p-3 text-center border-2 border-[#4F46E5]`;
                card.innerHTML = `
                    <div class="w-24 h-24 mx-auto mb-2 rounded-full overflow-hidden border-2 border-[#4F46E5]">
                        <img src="${player.image}" alt="${player.name}" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='https://placehold.co/100x100/4F46E5/FFFFFF?text=Player';">
                    </div>
                    <div class="team-crest-circle" style="background-color: ${teamColor};">
                        ${player.team}
                    </div>
                    <p class="font-semibold text-white text-md">${player.name}</p>
                    <p class="text-gray-400 text-xs">v ${player.opponent}</p>
                    <div class="text-2xl font-bold mt-2 text-green-400">${player.points} pts</div>
                `;
                pickedPlayersGrid.appendChild(card);
            });

            totalPointsDisplay.textContent = totalPoints;
        }

        /**
         * Resets the game to the initial selection screen.
         */
        function resetGame() {
            // Clear selected players
            for (const positionType in selectedPlayers) {
                selectedPlayers[positionType] = [];
            }
            localStorage.removeItem('pickedTeam'); // Clear local storage

            // Show selection screen, hide results screen
            resultsScreen.classList.add('hidden');
            selectionScreen.classList.remove('hidden');
            selectionFooter.classList.remove('hidden');

            // Re-render all player rows to reflect reset state
            renderPlayers('defenders', document.querySelector('#defenders-row .flex'));
            renderPlayers('midfielders', document.querySelector('#midfielders-row .flex'));
            renderPlayers('forwards', document.querySelector('#forwards-row .flex'));

            updateSaveButtonState(); // Ensure save button is disabled initially
        }

        /**
         * Saves the current selected players state to local storage.
         */
        function savePicksToLocalStorage() {
            localStorage.setItem('pickedTeam', JSON.stringify(selectedPlayers));
        }

        /**
         * Loads selected players state from local storage on page load.
         */
        function loadPicksFromLocalStorage() {
            const savedPicks = localStorage.getItem('pickedTeam');
            if (savedPicks) {
                try {
                    const parsedPicks = JSON.parse(savedPicks);
                    // Ensure the loaded data structure matches expected,
                    // and filter out any players that might no longer exist in the data
                    for (const positionType in selectedPlayers) {
                        if (parsedPicks[positionType]) {
                            selectedPlayers[positionType] = parsedPicks[positionType].filter(playerId =>
                                players[positionType].some(p => p.id === playerId)
                            );
                        }
                    }
                } catch (e) {
                    console.error("Error parsing saved picks from local storage:", e);
                    // Clear corrupted data if parsing fails
                    localStorage.removeItem('pickedTeam');
                }
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            loadPicksFromLocalStorage(); // Load state first
            renderPlayers('defenders', document.querySelector('#defenders-row .flex'));
            renderPlayers('midfielders', document.querySelector('#midfielders-row .flex'));
            renderPlayers('forwards', document.querySelector('#forwards-row .flex'));

            // Attach a single event listener to the document body for delegation
            // This ensures clicks on the button itself, or its children (like text), are caught.
            document.body.addEventListener('click', (event) => {
                let targetButton = event.target.closest('.pick-btn');
                if (targetButton && !targetButton.disabled) { // Added check for disabled state
                    handlePickButtonClick(event);
                }
            });

            savePicksBtn.addEventListener('click', showResultsScreen);
            playAgainBtn.addEventListener('click', resetGame); // Event listener for the new "Play Again" button
            updateSaveButtonState(); // Initial state update for save button
        });
    </script>
</body>
</html>
